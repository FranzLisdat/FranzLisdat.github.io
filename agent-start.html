<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franz Lisdat</title>
    <link rel="stylesheet" href="css/agent-optionen.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>

</head>
<body>
    <div class="navbar">
        <div class="container">
            <a class="logo" href="index.html">Franz <span>Lisdat</span></a>

            <img id="mobile-cta" class="mobile-menu" src="images/menu.svg" alt="open-navigation">
          
            <nav>
                <img src="images/exit.svg" id="mobile-exit" class="mobile-menu-exit" alt="exit-navigation">
                <ul class="primary-nav">
                    <li class="current"><a href="/index.html">Home</a></li>
                    <li><a href="/agent.html">Agent</a></li>
                    <li><a href="/index.html">Kontakt</a></li>
                </ul>
                <ul class="secondary-nav">
                    <li><a href="index.html">DE/EN</a></li>
                    <li class="lightdark"><a href="index.html">Light/DarkMode</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <section class="hero">
        <h1><span id="anweisung"></span></h1>
            <h3>noch : <span id="result"></span> Rolle (n) zu vergeben!</h3>

            <div class="wrapper" id="wrapperId">
                <div class="profile" id="profileId">
                    <div id= "userdata" border="2">
                        <ul>
                            <li>Ort : <span id="spiel-ort"></span></li>
                            <li>Rolle : <span id="textfeld"></span></li> 
                        </ul>
                    </div>
                    <button type="button" id="weiter-button" class="weiter-button" value="Click" onclick="weiterFunktion()">Weiter</button></li>
                </div>
                <button type="button" id="start-button" class="start-button hidden"  value="Click" onclick="startFunktion()">Start!</button></li>
            </div>
    </section>

  
        <div class="countDown">
            <p id="demo"></p>
        </div>

    
    <script>

    
  

        var anweisung = "Drücke auf Los! um die erste Rolle angezeigt zu bekommen!";
        var weiterButtonText = "Los!";
        var Spieleranzahl = localStorage.getItem("spielerValue");
        var zeitFuersSpiel = localStorage.getItem("zeitValue");
        var spielOrtString;
        var spielOrtStringAbspeicherung = ""; 
        var personen = [];
        var rollenText = "";
        var verbleibeneSpieler = 0;
        var i = 0; 

        document.getElementById("anweisung").innerHTML = anweisung;
        document.getElementById("weiter-button").innerHTML = weiterButtonText;

      
        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
            }
        return a;
        }
        

            $.getJSON('datenbank.json', function(data) {
                var randomNumber = Math.floor(Math.random() * data.ort.length);
                spielOrtString = Object.keys(data.ort[randomNumber]);
                personen = data["ort"][randomNumber][spielOrtString];
                shuffle(personen.person);
                personen.person.splice(0,13-Spieleranzahl);
                personen.person.push({id:12,bezeichnung:"Agent"});
                spielOrtStringAbspeicherung = spielOrtString;
              }).then(function(){
                verbleibeneSpieler = personen.person.length;
                document.getElementById("result").innerHTML = verbleibeneSpieler;
              });

  


        function weiterFunktion(){
            console.log("Array length: " + personen.person.length);
            if (personen.person.length!= 0){
                if (rollenText === "") {
                    anweisung = "Merk dir die Infos!";
                    weiterButtonText = "Habs!"
                    spielOrtString = spielOrtStringAbspeicherung;
                    i++;
                    var randomNumberFuerPerson = Math.floor(Math.random() * personen.person.length);
                    var bezeichnung = personen.person[randomNumberFuerPerson].bezeichnung;
                    console.log(bezeichnung);
                    personen.person.splice(randomNumberFuerPerson,1);
                    rollenText = bezeichnung;
                    if (bezeichnung == "Agent"){
                        spielOrtString = "???";    
                        }
                }   else if (rollenText !== ""){
                        anweisung = "Gib das Handy weiter!";
                        weiterButtonText = "Zeig her!";
                        rollenText = "";
                        spielOrtString = "";
                    }
                // Update alle Infos auf der HTML
                document.getElementById("weiter-button").innerHTML = weiterButtonText;
                document.getElementById("anweisung").innerHTML = anweisung;
                document.getElementById("textfeld").innerHTML = rollenText;
                document.getElementById("spiel-ort").innerHTML = spielOrtString;
            //Alles hidden machen und Timer zeigen
            } else {
                anweisung = "Starte den Timer!"
                document.getElementById("anweisung").innerHTML = anweisung;
                hideText = document.getElementById("profileId");
                hideText.classList.add("hidden");
                showText = document.getElementById("start-button");
                showText.classList.remove("hidden");
                //showText.classList.add("visible");
            }
            verbleibeneSpieler = personen.person.length;
            document.getElementById("result").innerHTML = verbleibeneSpieler;
        }
        function startFunktion(){
        timer();
        }

        function timer(){
        // Zeit für das Spiel in Minuten
            var now = new Date().getTime();

            var countDownDate = now + (zeitFuersSpiel*1003*60);
            // Update the count down every 1 second
            var x = setInterval(function() {
                
            // Find the distance between now and the count down date
            now = new Date().getTime();
            var distance = countDownDate - now;
            // Time calculations minutes and seconds
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
            // Output the result in an element with id="demo"
            document.getElementById("demo").innerHTML = minutes + "m " + seconds + "s ";
                
                // If the count down is over, write some text 
                if (distance < 0) {
                    clearInterval(x);
                    document.getElementById("demo").innerHTML = "EXPIRED";
                }
            }, 1000);
        }


        
        const mobileBtn = document.getElementById("mobile-cta");
        nav = document.querySelector("nav"); // does the same but without the ID
        mobileBtnExit = document.getElementById("mobile-exit");
        
        mobileBtn.addEventListener("click", () => {
            nav.classList.add("menu-btn");
        })

        mobileBtnExit.addEventListener("click", () => {
            nav.classList.remove("menu-btn");
        })
    </script>
</body>

</html>
